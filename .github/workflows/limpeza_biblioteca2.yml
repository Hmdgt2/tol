name: Limpar e Consolidar Biblioteca 2

on:
  workflow_dispatch:

jobs:
  organizar_funcoes:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: 📥 Checkout
        uses: actions/checkout@v4

      - name: 🐍 Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.13"

      - name: 📦 Install Dependencies
        run: |
          pip install astunparse scikit-learn numpy sympy scipy
          pip install xgboost lightgbm || true

      - name: 🧹 Run Organization
        run: |
          export PYTHONPATH=$PYTHONPATH:$(pwd)/scripts
          python scripts/organizador_biblioteca.py

      - name: 🔧 Fix Syntax Errors
        run: |
          python -c "
          import ast, re, os
          files = ['lib/funcoes_limpas/sistemas_dinamicos_avancados.py', 'lib/funcoes_limpas/estatistica_multivariada_2.py', 'lib/funcoes_limpas/modelagem_probabilistica.py', 'lib/funcoes_limpas/geometria_computacional.py']
          for f in files:
              if os.path.exists(f):
                  with open(f, 'r') as file:
                      content = file.read()
                  content = re.sub(r'from\s+\.\.\s*import', 'from .. import', content)
                  content = re.sub(r'\(\s*,\s*', '(', content)
                  content = re.sub(r',\s*\)', ')', content)
                  try:
                      ast.parse(content)
                      with open(f, 'w') as file:
                          file.write(content)
                      print(f'✅ Fixed: {f}')
                  except: 
                      print(f'❌ Still invalid: {f}')
          "

      - name: 💾 Commit Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '✨ CI: Biblioteca consolidada'
          branch: main
